<div class="container-fluid">
  <div class="row p-2 bg-info">
    <div class="col-6">
      <h3>Course List</h3>
    </div>
    <div class="col-6 text-end">
      <button class="btn btn-warning" (click)="openModal()">Add Course</button>
    </div>
  </div>

  <div class="row mb-2">
    <div class="col-6">
      <label for="pageSize" class="form-label">Records Per Page:</label>
      <select id="pageSize" class="form-select w-auto d-inline-block"
              [(ngModel)]="itemsPerPage"
              (change)="p = 1">
        <option [ngValue]="5">5</option>
        <option [ngValue]="10">10</option>
        <option [ngValue]="20">20</option>
        <option [ngValue]="50">50</option>
      </select>
    </div>
    <div class="col-6 text-end">
      <input type="text" class="form-control w-auto d-inline-block"
             placeholder="Search..."
             [(ngModel)]="searchText">
    </div>
  </div>

  @if (courses && courses.length > 0) {
  <table class="table table-bordered table-striped">
    <thead>
      <tr>
        <th style="width:50px">Sl No</th>
        <th>Course Name</th>
        <th>Short Code</th>
        <th>Fee</th>
        <th>Status</th>
        <th class="text-center">Action</th>
      </tr>
    </thead>
    <tbody>
      @for (item of courses | paginate: { itemsPerPage: itemsPerPage, currentPage: p }; track $index) {
      <tr>
        <td style="width:50px">{{ $index + 1 }}</td>
        <td>{{ item.courseName }}</td>
        <td>{{ item.shortCode }}</td>
        <td>{{ item.courseFee }}</td>
        <td>
          <span class="badge" [ngClass]="item.isActive ? 'bg-success' : 'bg-secondary'">
            {{ item.isActive ? 'Active' : 'Inactive' }}
          </span>
        </td>
        <td class="text-center">
          <button class="btn btn-info" (click)="openDetailsModal(item)" style="height:35px; width:75px;">
            Details
          </button> ||
          <button class="btn btn-primary" (click)="onEdit(item)" style="height:35px; width:75px;">
            Edit
          </button> ||
          <button class="btn btn-danger" (click)="onDelete(item)" style="height:35px; width:75px;">
            Delete
          </button>
        </td>
      </tr>
      }
    </tbody>
  </table>
  <pagination-controls (pageChange)="p = $event" class="mt-3"></pagination-controls>
  } @else {
  <h5 class="text-center p-5">No Courses Found</h5>
  }
</div>

<!-- Course Modal -->
<div class="modal" id="courseModal" #courseModal>
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <!-- Modal Header -->
      <div class="modal-header bg-info">
        <h4 class="modal-title">{{ isEditMode ? 'Update Course' : 'Add Course' }}</h4>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>

      <!-- Modal Body -->
      <form [formGroup]="courseForm" (ngSubmit)="onSubmit()">
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Course Name</label>
              <input type="text" class="form-control" formControlName="courseName">
            </div>
            <div class="col-md-6">
              <label class="form-label">Short Code</label>
              <input type="text" class="form-control" formControlName="shortCode">
            </div>
            <div class="col-md-6">
              <label class="form-label">Total Hours</label>
              <input type="text" class="form-control" formControlName="totalHours">
            </div>
            <div class="col-md-6">
              <label class="form-label">Course Fee</label>
              <input type="number" class="form-control" formControlName="courseFee">
            </div>
            <div class="col-12">
              <label class="form-label">Remarks</label>
              <textarea class="form-control" formControlName="remarks"></textarea>
            </div>
            <!--<div class="col-md-6">
              <label class="form-label">Created Date</label>
              <input type="datetime-local" class="form-control" formControlName="createdDate" [readOnly]="isEditMode">
            </div>-->

            <div class="col-md-6">
              <label class="form-label">Created Date</label>
              <input type="datetime-local" class="form-control"
                     formControlName="createdDate"
                     [readOnly]="isEditMode">
            </div>
            <div class="col-md-6">
              <div class="form-check mt-4 pt-3">
                <input type="checkbox" class="form-check-input" formControlName="isActive">
                <label class="form-check-label">Is Active?</label>
              </div>
            </div>

            <!-- Instructor Assignments -->
            <div class="col-12">
              <h5>Instructor Assignments</h5>
              <div formArrayName="instructorAssignments">
                <div *ngFor="let assignment of instructorAssignments.controls; let i = index" [formGroupName]="i" class="mb-3 border p-2">
                  <div class="row g-2">
                    <div class="col-md-6">
                      <label class="form-label">Instructor</label>
                      <select class="form-select" formControlName="instructorId">
                        <option value="">Select Instructor</option>
                        <option *ngFor="let instructor of instructors" [value]="instructor.instructorId">
                          {{ instructor.employee?.employeeName }}
                        </option>
                      </select>
                    </div>
                    <div class="col-md-4">
                      <div class="form-check mt-4">
                        <input class="form-check-input" type="checkbox" formControlName="isPrimaryInstructor">
                        <label class="form-check-label">Primary Instructor</label>
                      </div>
                    </div>
                    <div class="col-md-2">
                      <button type="button" class="btn btn-danger mt-3" (click)="removeInstructorAssignment(i)">
                        Remove
                      </button>
                    </div>
                  </div>
                </div>
                <button type="button" class="btn btn-secondary mb-3" (click)="addInstructorAssignment()">
                  Add Instructor
                </button>
              </div>
            </div>

            <!-- Classroom Assignments -->
            <div class="col-12">
              <h5>Classroom Assignments</h5>
              <div formArrayName="classroomAssignments">
                <div *ngFor="let assignment of classroomAssignments.controls; let i = index" [formGroupName]="i" class="mb-3 border p-2">
                  <div class="row g-2">
                    <div class="col-md-6">
                      <label class="form-label">Classroom</label>
                      <select class="form-select" formControlName="classRoomId">
                        <option value="">Select Classroom</option>
                        <option *ngFor="let classroom of classrooms" [value]="classroom.classRoomId">
                          {{ classroom.roomName }}
                        </option>
                      </select>
                    </div>
                    <div class="col-md-4">
                      <div class="form-check mt-4">
                        <input class="form-check-input" type="checkbox" formControlName="isAvailable">
                        <label class="form-check-label">Available</label>
                      </div>
                    </div>
                    <div class="col-md-2">
                      <button type="button" class="btn btn-danger mt-3" (click)="removeClassroomAssignment(i)">
                        Remove
                      </button>
                    </div>
                  </div>
                </div>
                <button type="button" class="btn btn-secondary mb-3" (click)="addClassroomAssignment()">
                  Add Classroom
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Modal Footer -->
        <div class="modal-footer">
          <button type="submit" [disabled]="courseForm.invalid || isSubmitting" class="btn btn-primary">
            {{ isEditMode ? 'Update' : 'Save' }}
          </button>
          <button type="button" class="btn btn-secondary" (click)="closeModal()">Close</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Details Modal -->
<div class="modal" id="detailsModal" #detailsModal>
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-info text-white">
        <h5 class="modal-title">Course Details</h5>
        <button type="button" class="btn-close" (click)="closeDetailsModal()"></button>
      </div>
      <div class="modal-body" *ngIf="selectedCourse">
        <div class="row">
          <!-- Basic course info remains the same -->
          <div class="col-md-6">
            <p><strong>Name:</strong> {{ selectedCourse.courseName }}</p>
            <p><strong>Short Code:</strong> {{ selectedCourse.shortCode }}</p>
            <p><strong>Total Hours:</strong> {{ selectedCourse.totalHours }}</p>
          </div>
          <div class="col-md-6">
            <p><strong>Fee:</strong> {{ selectedCourse.courseFee }}</p>
            <p>
              <strong>Status:</strong>
              <span [class.text-success]="selectedCourse.isActive" [class.text-danger]="!selectedCourse.isActive">
                {{ selectedCourse.isActive ? 'Active' : 'Inactive' }}
              </span>
            </p>
            <p><strong>Created:</strong> {{ selectedCourse.createdDate | date:'medium' }}</p>
          </div>

          <!-- Updated Instructors Section -->
          <div class="col-12 mt-3" *ngIf="selectedCourse.instructors?.length">
            <h6>Instructors:</h6>
            <ul class="list-group">
              <li class="list-group-item" *ngFor="let instructor of selectedCourse.instructors">
                {{ instructor.employeeName || 'N/A' }}
                <span *ngIf="instructor.isPrimaryInstructor" class="badge bg-primary ms-2">
                  Primary
                </span>
              </li>
            </ul>
          </div>

          <!-- Updated Classrooms Section -->
          <div class="col-12 mt-3" *ngIf="selectedCourse.classRoom?.length">
            <h6>Classrooms:</h6>
            <ul class="list-group">
              <li class="list-group-item" *ngFor="let room of selectedCourse.classRoom">
                {{ room.roomName || 'N/A' }}
                <span class="badge" [class.bg-success]="room.isAvailable" [class.bg-danger]="!room.isAvailable">
                  {{ room.isAvailable ? 'Available' : 'Unavailable' }}
                </span>
              </li>
            </ul>
          </div>

          <div class="col-12 mt-3" *ngIf="selectedCourse.remarks">
            <p><strong>Remarks:</strong> {{ selectedCourse.remarks }}</p>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeDetailsModal()">Close</button>
      </div>
    </div>
  </div>
</div>
